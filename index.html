<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Pastelaria da Nathy</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
    body {
        font-family: Arial, sans-serif;
        background: #ffe4f2;
        margin: 0;
        padding: 0;
        color: #333;
    }

    .app {
        max-width: 450px;
        margin: auto;
        padding: 20px;
    }

    h2 {
        color: #d63384;
        text-align: center;
    }

    input, select, button, textarea {
        width: 100%;
        padding: 14px;
        margin: 8px 0;
        border-radius: 12px;
        border: 1px solid #ccc;
        font-size: 18px;
    }

    button {
        background: #ff5fa2;
        color: white;
        border: none;
        font-weight: bold;
        cursor: pointer;
    }

    button:hover {
        background: #e64b8a;
    }

    .hidden { display: none; }

    .pedido {
        background: white;
        padding: 12px;
        border-radius: 12px;
        margin-bottom: 10px;
        border-left: 6px solid #ff5fa2;
    }

    .btn-small {
        padding: 8px;
        font-size: 14px;
        border-radius: 10px;
    }

</style>
</head>
<body>

<div class="app">

    <!-- LOGIN -->
    <div id="login">
        <h2>Pastelaria da Nathy</h2>
        <select id="userSelect">
            <option>Nathy</option>
            <option>Jean</option>
            <option>Juan</option>
        </select>
        <input type="password" id="senha" placeholder="Senha">
        <button onclick="login()">Entrar</button>
    </div>

    <!-- MENU -->
    <div id="menu" class="hidden">
        <h2 id="userTitle"></h2>
        <button onclick="showPage('vendas')">Registrar Venda</button>
        <button onclick="showPage('lista')">Lista de Vendas</button>
        <button onclick="showPage('fechar')">Fechar Dia</button>
        <button onclick="backup()">Backup</button>
        <input type="file" id="restoreFile" onchange="restoreBackup()">
        <button onclick="logout()">Sair</button>
    </div>

    <!-- REGISTRAR VENDA -->
    <div id="vendas" class="hidden">
        <h2>Nova Venda</h2>

        <input type="date" id="data">
        
        <select id="item">
            <option>Carne com cheddar</option>
            <option>Frango com cheddar</option>
            <option>Carne com requeijão</option>
            <option>Frango com requeijão</option>
        </select>

        <input type="number" id="qtd" min="1" value="1">

        <label><input type="checkbox" id="refri"> Com refri (+2)</label>

        <textarea id="obs" placeholder="Observações (opcional)"></textarea>

        <label>Status:</label>
        <button onclick="setPago(true)">Pago</button>
        <button onclick="setPago(false)">Pendente</button>

        <button onclick="salvarPedido()">Salvar Pedido</button>
        <button onclick="showPage('menu')">Voltar</button>
    </div>

    <!-- LISTA -->
    <div id="lista" class="hidden">
        <h2>Vendas Registradas</h2>
        <div id="listaConteudo"></div>
        <button onclick="showPage('menu')">Voltar</button>
    </div>

    <!-- FECHAR DIA -->
    <div id="fechar" class="hidden">
        <h2>Fechamento</h2>
        <div id="fecharConteudo"></div>
        <button onclick="showPage('menu')">Voltar</button>
    </div>

</div>


<script>
/* ========= BANCO DE DADOS ========= */
let db = JSON.parse(localStorage.getItem("pastelariaDB") || "[]");
let pagoStatus = false;
let usuarioLogado = "";

/* ========= LOGIN ========= */
function login() {
    const senha = document.getElementById("senha").value;
    if (senha !== "1234") {
        alert("Senha incorreta!");
        return;
    }

    usuarioLogado = document.getElementById("userSelect").value;

    document.getElementById("login").classList.add("hidden");
    document.getElementById("menu").classList.remove("hidden");

    document.getElementById("userTitle").innerText =
        "Vendedor: " + usuarioLogado;
}

/* ========= LOGOUT ========= */
function logout() {
    location.reload();
}

/* ========= TROCAR PÁGINAS ========= */
function showPage(id) {
    document.querySelectorAll(".app > div").forEach(div => div.classList.add("hidden"));
    document.getElementById(id).classList.remove("hidden");

    if (id === "lista") renderLista();
    if (id === "fechar") renderFechamento();
}

/* ========= STATUS ========= */
function setPago(v) {
    pagoStatus = v;
}

/* ========= SALVAR PEDIDO ========= */
function salvarPedido() {
    const pedido = {
        vendedor: usuarioLogado,
        data: document.getElementById("data").value,
        item: document.getElementById("item").value,
        qtd: Number(document.getElementById("qtd").value),
        refri: document.getElementById("refri").checked,
        obs: document.getElementById("obs").value,
        pago: pagoStatus,
        valor: 10 * Number(document.getElementById("qtd").value) + (document.getElementById("refri").checked ? 2 : 0)
    };

    db.push(pedido);
    localStorage.setItem("pastelariaDB", JSON.stringify(db));

    alert("Venda registrada!");
    showPage("menu");
}

/* ========= LISTA ========= */
function renderLista() {
    const div = document.getElementById("listaConteudo");
    div.innerHTML = "";

    db.forEach((p, i) => {
        div.innerHTML += `
            <div class="pedido">
                <b>${p.item}</b> — R$ ${p.valor}<br>
                Qtd: ${p.qtd} | Data: ${p.data}<br>
                Refri: ${p.refri ? "Sim" : "Não"}<br>
                Status: ${p.pago ? "Pago" : "Pendente"}<br>
                Vendedor: ${p.vendedor}<br>
                Obs: ${p.obs || "(nenhuma)"}<br><br>
                <button class="btn-small" onclick="editar(${i})">Editar</button>
            </div>
        `;
    });
}

/* ========= EDITAR ========= */
function editar(i) {
    const p = db[i];

    document.getElementById("data").value = p.data;
    document.getElementById("item").value = p.item;
    document.getElementById("qtd").value = p.qtd;
    document.getElementById("refri").checked = p.refri;
    document.getElementById("obs").value = p.obs;
    pagoStatus = p.pago;

    db.splice(i, 1);
    localStorage.setItem("pastelariaDB", JSON.stringify(db));

    showPage("vendas");
}

/* ========= FECHAMENTO ========= */
function renderFechamento() {
    let vendedores = {};

    db.forEach(p => {
        if (!vendedores[p.vendedor]) vendedores[p.vendedor] = 0;
        vendedores[p.vendedor] += p.valor;
    });

    let html = "";
    for (let v in vendedores) {
        html += `<b>${v}</b>: R$ ${vendedores[v]}<br>`;
    }

    document.getElementById("fecharConteudo").innerHTML = html;
}

/* ========= BACKUP ========= */
function backup() {
    const blob = new Blob([JSON.stringify(db)], { type: "application/json" });
    const url = URL.createObjectURL(blob);

    const a = document.createElement("a");
    a.href = url;
    a.download = "pastelaria_backup.json";
    a.click();
}

/* ========= RESTAURAR BACKUP ========= */
function restoreBackup() {
    const file = document.getElementById("restoreFile").files[0];
    const reader = new FileReader();

    reader.onload = e => {
        db = JSON.parse(e.target.result);
        localStorage.setItem("pastelariaDB", JSON.stringify(db));
        alert("Backup restaurado!");
    };

    reader.readAsText(file);
}

</script>

</body>
</html>