<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Pastelaria da Nathy</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>

body {
    font-family: Arial, sans-serif;
    background: #ffe4f0;
    margin: 0;
    padding: 0;
}

.container {
    max-width: 500px;
    margin: auto;
    padding: 20px;
}

h1, h2 {
    text-align: center;
    color: #d63384;
}

input, select, button, textarea {
    width: 100%;
    padding: 14px;
    margin: 8px 0;
    border-radius: 10px;
    border: 1px solid #ffb3d9;
    font-size: 18px;
}

button {
    background: #d63384;
    color: white;
    font-weight: bold;
    border: none;
}

button:hover { opacity: 0.8; }

.btn-small {
    padding: 6px;
    font-size: 14px;
    margin-top: 5px;
}

#app, #vendas, #fechamento { display: none; }

.pedido {
    background: white;
    padding: 12px;
    border-radius: 10px;
    margin-bottom: 10px;
    border-left: 6px solid #d63384;
}

</style>
</head>
<body>

<div class="container">

<!-- LOGIN -->
<div id="login">
    <h1>Pastelaria da Nathy</h1>
    <h2>Login</h2>

    <select id="userSelect">
        <option>Nathy</option>
        <option>Jean</option>
        <option>Juan</option>
    </select>

    <input type="password" id="senha" placeholder="Senha">

    <button onclick="entrar()">Entrar</button>
</div>

<!-- APP -->
<div id="app">
    <h1 id="userTitle"></h1>

    <button onclick="mostrarVendas()">Registrar Venda</button>
    <button onclick="mostrarLista()">Lista de Vendas</button>
    <button onclick="mostrarFechamento()">Fechar Dia</button>
    <button onclick="baixarBackup()">Backup</button>
</div>

<!-- REGISTRAR VENDA -->
<div id="vendas">
    <h2>Nova Venda</h2>

    <input type="date" id="data">

    <input type="text" id="cliente" placeholder="Nome do cliente">

    <select id="item">
        <option>Carne com cheddar</option>
        <option>Frango com cheddar</option>
        <option>Carne com requeijão</option>
        <option>Frango com requeijão</option>
    </select>

    <input type="number" id="qtd" value="1" min="1">

    <label><input type="checkbox" id="refri"> Com Refri (+2)</label>

    <textarea id="obs" placeholder="Observações"></textarea>

    <label><input type="checkbox" id="pago"> Pago</label>

    <button onclick="salvarPedido()">Salvar Pedido</button>
    <button onclick="voltar()">Voltar</button>
</div>

<!-- LISTA -->
<div id="lista"></div>

<!-- FECHAMENTO -->
<div id="fechamento">
    <h2>Fechamento do Dia</h2>
    <input type="date" id="dataFechar">
    <button onclick="gerarFechamento()">Gerar</button>
    <div id="resultadoFechamento"></div>
    <button onclick="voltar()">Voltar</button>
</div>

</div>

<script>

// BANCO DE DADOS
function carregarDB() {
    let db = localStorage.getItem("pastelariaDB");
    if (!db) {
        db = { senha: "1234", pedidos: [] };
        localStorage.setItem("pastelariaDB", JSON.stringify(db));
    }
    return JSON.parse(db);
}

function salvarDB(db) {
    localStorage.setItem("pastelariaDB", JSON.stringify(db));
}

let usuarioLogado = "";

// LOGIN
function entrar() {
    const db = carregarDB();
    const senha = document.getElementById("senha").value;

    if (senha !== db.senha) {
        alert("Senha incorreta!");
        return;
    }

    usuarioLogado = document.getElementById("userSelect").value;
    document.getElementById("login").style.display = "none";
    document.getElementById("app").style.display = "block";
    document.getElementById("userTitle").innerText = "Bem-vindo, " + usuarioLogado;
}

function mostrarVendas() {
    document.getElementById("app").style.display = "none";
    document.getElementById("vendas").style.display = "block";
}

function mostrarLista() {
    const db = carregarDB();
    let html = "<h2>Vendas</h2>";

    db.pedidos.forEach((p, i) => {
        html += `
        <div class="pedido">
            <b>${p.item}</b> — R$ ${p.valor}<br>
            Cliente: ${p.cliente}<br>
            Qtd: ${p.qtd}<br>
            Refri: ${p.refri ? "Sim" : "Não"}<br>
            Pago: ${p.pago ? "Sim" : "Não"}<br>
            Vendedor: ${p.vendedor}<br>
            Obs: ${p.obs || "(nenhuma)"}<br>
            <button class="btn-small" onclick="editar(${i})">Editar</button>
        </div>`;
    });

    html += `<button onclick="voltar()">Voltar</button>`;
    document.getElementById("lista").innerHTML = html;
    document.getElementById("lista").style.display = "block";
    document.getElementById("app").style.display = "none";
}

// SALVAR
function salvarPedido() {
    const db = carregarDB();

    const qtd = Number(document.getElementById("qtd").value);
    const refri = document.getElementById("refri").checked;
    const valor = 10 * qtd + (refri ? 2 : 0);

    db.pedidos.push({
        data: document.getElementById("data").value,
        cliente: document.getElementById("cliente").value,
        item: document.getElementById("item").value,
        qtd,
        refri,
        obs: document.getElementById("obs").value,
        pago: document.getElementById("pago").checked,
        valor,
        vendedor: usuarioLogado
    });

    salvarDB(db);
    alert("Pedido salvo!");
    voltar();
}

// EDITAR
function editar(i) {
    const db = carregarDB();
    const p = db.pedidos[i];

    document.getElementById("data").value = p.data;
    document.getElementById("cliente").value = p.cliente;
    document.getElementById("item").value = p.item;
    document.getElementById("qtd").value = p.qtd;
    document.getElementById("refri").checked = p.refri;
    document.getElementById("obs").value = p.obs;
    document.getElementById("pago").checked = p.pago;

    db.pedidos.splice(i, 1);
    salvarDB(db);

    mostrarVendas();
}

// FECHAR DIA
function mostrarFechamento() {
    document.getElementById("app").style.display = "none";
    document.getElementById("fechamento").style.display = "block";
}

function gerarFechamento() {
    const db = carregarDB();
    const data = document.getElementById("dataFechar").value;

    const filtrados = db.pedidos.filter(p => p.data === data);

    let total = 0;
    let porVendedor = {};

    filtrados.forEach(p => {
        total += p.valor;
        if (!porVendedor[p.vendedor]) porVendedor[p.vendedor] = 0;
        porVendedor[p.vendedor] += p.valor;
    });

    let html = "<h3>Total: R$ " + total + "</h3>";

    html += "<h3>Por Vendedor:</h3>";
    for (let nome in porVendedor) {
        html += `${nome}: R$ ${porVendedor[nome]}<br>`;
    }

    document.getElementById("resultadoFechamento").innerHTML = html;
}

// BACKUP
function baixarBackup() {
    const db = carregarDB();
    const blob = new Blob([JSON.stringify(db)], { type: "application/json" });
    const url = URL.createObjectURL(blob);

    const a = document.createElement("a");
    a.href = url;
    a.download = "backup_pastelaria.json";
    a.click();
}

function voltar() {
    document.getElementById("vendas").style.display = "none";
    document.getElementById("lista").style.display = "none";
    document.getElementById("fechamento").style.display = "none";
    document.getElementById("app").style.display = "block";
}

</script>

</body>
</html>